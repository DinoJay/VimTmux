String.prototype.quote = function() {
    return "'" + this + "'";
};

function quote(str) { return "'" + str + "'";}

function makeAjaxCall(ret, fceName, callback) {

    var API_URL = "http://localhost:3030/StarWars/query";
    var query = (
        "PREFIX fictu:<http://webprotege.stanford.edu/project/" +
        "pFQcTHFYhJGfU4INaGHqk#> " +
        "SELECT * " +
        "WHERE { " +
        "?fce fictu:hasName " + quote(fceName) + " ." +
        "?fce fictu:hasName ?fceName." +
        "?fce fictu:isParentOf ?child ." +
        "?child fictu:hasName ?childName" +
        "}"
    );
    var encodedQuery = encodeURIComponent(query);

    $.ajax({
        url: API_URL + "?query=" + encodedQuery,
        dataType: 'jsonp',
        Accept: 'application/sparql-results+json',
        success: function(data) {
            var results = data.results.bindings;
            console.log("results", results);
            if (results.length === 0) {
              callback(ret);
              return;
            }

            results.forEach(function(d){
              console.log("childName", d.childName);
              var childName = d.childName.value;
              ret.push(childName);
              makeAjaxCall(counter, childName, callback);
            });
            console.log("Ret", ret);
        },
        error: function (xhr, ajaxOptions, thrownError) {
          alert(xhr.status);
          alert(thrownError);
        }
    });
}
function ajaxWrapper(fceName, callback) {
  var result = [];
  makeAjaxCall(result, fceName, callback);
}

Meteor.myUtils = {
    ajaxWrapper: ajaxWrapper
};
